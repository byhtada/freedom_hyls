(function(){var e="1.3.1",t={},n={};this.$ipsp=function(e){return n[e]?n[e]:n[e]=arguments.callee.get(e)},this.$ipsp.get=function(e){if(!t[e])throw Error("module is undefined");return new t[e]},this.$ipsp.add=function(e,n){if(t[e])throw Error("module already added");t[e]=n},this.$ipsp.version=function(t){return e=t,this},this.$ipsp._debug_=function(){return Number(document.cookie.replace(/(?:(?:^|.*;\s*)ipsp_debug\s*\=\s*([^;]*).*$)|^.*$/,"$1"))}(),this.$ipsp.debug=function(e){document.cookie=["ipsp_debug",Number(e)].join("=")},this.$ipsp.log=function(){this._debug_&&"console"in window&&console.log.apply(console,arguments)}}).call(window||{}),function(){this.$oplata=this.$ipsp}.call(window||{}),function(){this.addListener=function(e,t,n){if(!e)return!1;e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n)}}(),function(){addListener(window,"error",function(e){$ipsp.log(e.message,e.filename,e.lineno,e.colno)})}(),function(){this.camelCase=function(e){return(e||"").toLowerCase().replace(/(\b|-)\w/g,function(e){return e.toUpperCase().replace(/-/,"")})}}.call(window||{}),function(){var e=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};this.isObject=function(t){return e(t)==="object"},this.isRegexp=function(t){return e(t)==="regexp"},this.isArguments=function(t){return e(t)==="arguments"},this.isError=function(t){return e(t)==="error"},this.isArray=function(t){return e(t)==="array"},this.isDate=function(t){return e(t)==="date"},this.isString=function(t){return e(t)==="string"},this.isNumber=function(t){return e(t)==="number"},this.isBoolean=function(t){return e(t)==="boolean"},this.isElement=function(e){return e&&e.nodeType===1},this.getType=e}.call(window||{}),function(){this.popupBlocker=function(e){var t=!1;try{typeof e=="undefined"?t=!0:e&&e.closed?t=!1:e&&e.test?t=!1:t=!0}catch(n){}return t}}.call(window||{}),function(){this.prepareFormData=function(e,t,n,r){var i,s=document.createElement("form");s.action=e,s.target=n||"_self",s.method=r||"POST";for(var o in t)t.hasOwnProperty(o)&&(i=document.createElement("input"),i.type="hidden",i.name=o,i.value=t[o],s.appendChild(i));return s.style.display="none",s}}.call(window||{}),function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){if(!(this instanceof arguments.callee))throw Error('use Class with "extend" method')},this.Class.prototype={init:function(){}},this.Class.extend=function(n){function o(t){e||this.init.apply(this,arguments)}var r,i,s=this.prototype;e=!0,i=new this,e=!1;for(r in n)n.hasOwnProperty(r)&&(typeof s[r]=="function"&&typeof n[r]=="function"&&t.test(n[r])?i[r]=function(e,t){return function(){var n=this._super,r;return this._super=s[e],r=t.apply(this,arguments),this._super=n,r}}(r,n[r]):i[r]=n[r]);return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o}}.call(window||{}),function(){var e={},t=-1;this.publish=function(t,n){$ipsp.log(t,n);if(!e[t])return!1;var r=e[t],s=r?r.length:0,o=Array.prototype.slice.call(arguments,2),t=t.split("/").pop();for(i=0;i<s;i++)r[i].func(n,t);return this},this.subscribe=function(n,r){e[n]||(e[n]=[]);var i=(++t).toString();return e[n].push({token:i,func:r}),i},this.unsubscribe=function(t){for(var n in e)if(e.hasOwnProperty(n)&&e[n])for(var r=0,i=e[n].length;r<i;r++)if(e[n][r].token===t)return e[n].splice(r,1),t;return this}}.call(window.pubsub={}),function(e){function t(e,t){var n=!1,r=!0,i=e.document,s=i.documentElement,o=i.addEventListener,u=o?"addEventListener":"attachEvent",a=o?"removeEventListener":"detachEvent",f=o?"":"on",l=function(r){if(r.type=="readystatechange"&&i.readyState!="complete")return;(r.type=="load"?e:i)[a](f+r.type,l,!1),!n&&(n=!0)&&t.call(e,r.type||r)},c=function(){try{s.doScroll("left")}catch(e){setTimeout(c,50);return}l("poll")};if(i.readyState=="complete")t.call(e,"lazy");else{if(!o&&s.doScroll){try{r=!e.frameElement}catch(h){}r&&c()}i[u](f+"DOMContentLoaded",l,!1),i[u](f+"readystatechange",l,!1),e[u](f+"load",l,!1)}}e.domReady=function(n){t(e,n)}}(window),function(){this.Module=Class.extend({find:function(e){return isElement(e)?e:document.querySelector(e)||null},findAll:function(e){return document.querySelectorAll(e)},extend:function(){var t,n,r,i=arguments[0],s=Array.prototype.slice.call(arguments,1);for(t=0;t<s.length;t++)if((r=s[t])!==null)for(n in r)r.hasOwnProperty(n)&&(i[n]=r[n]);return i},proxy:function(e,t){var t=t||this;return function(){return e.apply(t,Array.prototype.slice.call(arguments))}},addCss:function(e,t){if(!e)return!1;for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])},fireEvent:function(e,t){var n;if(e)return document.createEventObject?(n=document.createEventObject(),e.fireEvent("on"+t,n)):(n=document.createEvent("HTMLEvents"),n.initEvent(t,!0,!0),!e.dispatchEvent(n))},addEvent:function(e,t,n){return e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)),this},removeEvent:function(e,t,n){return e&&(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)),this},onDomReady:function(e){return domReady(this.proxy(e)),this},addAttr:function(e,t){var n;if(!e)return!1;for(n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])},scope:function(e){return this.onDomReady(e),this},print:function(){var e,t=[];for(e in this)t.push([[this.name,e].join("."),getType(this[e])].join(" : "));return t.join("\n")}})}.call(window||{}),function(){var e=-1;this.Connector=Module.extend({name:"crossdomain",origin:"*",init:function(){this.addEvent(window,"message",this.proxy(this.route)),this.setName([this.name,++e,location.host].join("/"))},setName:function(e){e&&(this.name=e)},getName:function(){return this.name},setTarget:function(e){e&&(this.target=e)},getTarget:function(){return this.target||{postMessage:function(){}}},route:function(e){var t;try{t=JSON.parse(e.data.toString())}catch(n){return!1}if(this.getTarget()!==e.source)return!1;if(!t.action)return!1;t.action=="origin"&&this.setOrigin(t.data.origin),this.publish(t.action,t.data)},getOrigin:function(){return"*"},setOrigin:function(e){this.origin=e||"*"},action:function(e,t){return pubsub.subscribe([this.name,e].join("/"),t)},removeAction:function(e){return pubsub.unsubscribe(e),this},publish:function(e,t){return pubsub.publish([this.name,e].join("/"),t)},send:function(e,t){this.getTarget().postMessage(JSON.stringify({action:e,data:t}),this.getOrigin())}}),this.$ipsp.add("connector",this.Connector)}.call(window||{}),function(e){var t=e.host,n=e.protocol,r=e.origin,i={frameborder:"0",allowtransparency:"true"},s={zIndex:"9999",overflowX:"hidden",border:"0",display:"none",position:"static",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"100%"},o=function(e,t){var n;if(e.action=="redirect"){this.loadUrl(e.url);return}if(e.send_data.order_status=="processing")return;this.unbind("ready").action("ready",function(){this.show()}),e.send_data&&e.url&&(n=prepareFormData(e.url,e.send_data),this.find("body").appendChild(n),n.submit(),n.parentNode.removeChild(n))},u=Module.extend({name:"$ipsp.checkout",version:"1.0",iframe:null,connector:null,client_callback:!1,init:function(){this.options={checkout_attr:"href",checkout_url:null,wrapper:"body",styles:{},ismodal:!1},this.actions={},this.initConnector(),this.ready()},config:function(e){return this.extend(this.options,e),this},setModal:function(e){this.options.ismodal=e,this.onDomReady(function(){this.addCss(this.iframe,{position:this.options.ismodal===!0?"fixed":"static"})})},setCheckoutWrapper:function(e){this.options.wrapper=e},setCssStyle:function(e){this.extend(this.options.styles,e)},setCheckoutBg:function(e){this.onDomReady(function(){this.addCss(this.iframe,{background:e})})},setCheckoutWidth:function(e){return(e>=0||e=="auto")&&this.onDomReady(function(){this.addCss(this.iframe,{width:""}),this.addAttr(this.iframe,{width:e})}),this},width:function(e){return this.setCheckoutWidth(e),this},setCheckoutHeight:function(e){(e>=0||e=="auto")&&this.onDomReady(function(){this.addCss(this.iframe,{height:""}),this.addAttr(this.iframe,{height:e})})},height:function(e){return this.setCheckoutHeight(e),this},setCheckoutOrigin:function(e){if(!e)throw Error("url param is required");var t=document.createElement("a");return t.href=e,this.options.checkout_url=t.origin||[t.protocol,t.host].join("//"),this},getCheckoutOrigin:function(){if(!this.options.checkout_url)throw Error("checkout url is not defined");return this.options.checkout_url},setElementAttr:function(e){this.options.checkout_attr=e},setClickElement:function(e){this.onDomReady(function(){var t,n=this.findAll(e);for(t=0;t<n.length;t++)this.addEvent(n[t],"click",this.proxy(function(e){e.preventDefault(),this.loadUrl(e.target.getAttribute(this.options.checkout_attr))}))})},loadUrl:function(e,t){if(!e)throw Error("checkout url is not defined");t&&(e=e.concat("&autoredirect=").concat(t)),this.onDomReady(function(){if(!this.iframe)throw Error("checkout iframe is null or undefined");this.iframe.src=e,this.find(this.options.wrapper).appendChild(this.iframe)})},getCurrentOrigin:function(){return r||[n,t].join("//")},show:function(e){return this.options.ismodal===!0&&(this.addCss(this.find("body"),{overflow:"hidden"}),this.addCss(this.find("html"),{overflow:"hidden"})),this.addCss(this.iframe,{display:"block"}),this.iframe.focus(),e!==!0&&this.connector.publish("show",{}),this},hide:function(e){return this.options.ismodal===!0&&(this.addCss(this.find("body"),{overflow:""}),this.addCss(this.find("html"),{overflow:""})),this.addCss(this.iframe,{display:"none"}),e!==!0&&this.connector.publish("hide",{}),this},send:function(e,t){return this.connector.send(e,t),this},publish:function(e,t){this.connector.publish(e,t)},action:function(e,t){var n=this.connector.action(e,this.proxy(t,this));return isArray(this.actions[e])||(this.actions[e]=[]),this.actions[e].push(n),n},removeAction:function(e){return this.connector.removeAction(e),this},unbind:function(e){var t=this.actions[e];for(var n=0;n<t.length;n++)this.removeAction(t[n]);return this},ready:function(){return this.onDomReady(this.initFrame),this},initFrame:function(){if(this.iframe)throw Error("iframe already initialized");this.iframe=document.createElement("iframe"),this.addCss(this.iframe,s),this.addAttr(this.iframe,i),this.addEvent(this.iframe,"load",this.proxy(function(e){this.loadConnector(this.iframe)}))},initConnector:function(){this.connector=new Connector,this.action("load",function(e){this.send("origin",{origin:this.getCurrentOrigin(),styles:this.options.styles})}),this.action("cancel",function(e){this.options.ismodal&&this.hide()}),this.action("locale",function(e){this.locale=e}),this.action("ready",function(e){this.show()}),this.action("3dsform",function(e){this.acsCallback(e)}),this.action("callback",this.callback)},callback:function(e,t){this.send(t,e)},setAcsCallback:function(e){this.acsCallback=e},addCallback:function(e){return e||(e=o),this.client_callback||(this.unbind("callback"),this.client_callback=!0),this.action("callback",e),this.action("decline",e),this},acsCallback:function(e){var t=this,n=$ipsp.get("acsframe"),r=$ipsp.get("popup");r.config({width:"700px"}),r.close=this.proxy(function(){this.send("cancel")}),this.action("close_submit3ds",function(e){n.send("close")}),r.title.innerHTML=this.locale.HELP_3DS,this.addEvent(r.title.querySelector("a"),"click",function(){n.submitHelp()}),n.scope(function(){this.setData(e),this.setLocale(t.locale),this.setWrapper(r.content),this.action("close",function(){r.hide()}),this.action("load",function(){r.show()}),this.action("response",function(e){t.send("cancel"),t.publish("callback",e),r.hide()}),this.submit()})},submit3ds:function(e,t){return $ipsp.get("acssubmit").scope(function(){this.setData(e),this.setWrapper(t)})},loadConnector:function(e){this.setCheckoutOrigin(e.src),this.connector.setTarget(e.contentWindow),this.connector.setOrigin(this.getCheckoutOrigin())}});this.__DEFAULTCALLBACK__=o,this.Checkout=u,this.$ipsp.add("checkout",u)}.call(window||{},location||{}),function(){var e="https",t="api.fondy.eu",n="/api/checkout?button=",r=Class.extend({init:function(e){this.initialize(e)},initialize:function(e){this.setName(e.name),this.setValue(e.value),this.setLabel(e.label),this.setPlaceholder(e.placeholder),this.setRequired(e.required),this.setValid(e.valid),this.setHidden(e.hidden),this.setReadonly(e.readonly)},setName:function(e){return isString(e)||console.error("field property `name` is not a string",this),this.name=e,this},setHidden:function(e){return e&&!isBoolean(e)&&console.error("field property `hidden` is not an boolean",this),this.hidden=e,this},setPlaceholder:function(e){e&&!isString(e)&&console.error("field property `placeholder` is not a string",this),this.placeholder=e;return},setValue:function(e){return e&&!isString(e)&&console.error("field property `value` is not a string",this),this.value=e,this},setLabel:function(e){return isString(e)||console.error("field property `label` is not a string",this),this.label=e,this},setValid:function(e){var t,n=[];e&&!isObject(e)&&console.error("field property `valid` is not an object",this);for(t in e)e.hasOwnProperty(t)&&n.push([t,e[t]].join(":"));return this.valid=n.concat(this.valid).join(";"),this},setRequired:function(e){this.valid="",e&&isBoolean(e)&&(this.valid="required")},setReadonly:function(e){return e&&!isBoolean(e)&&console.error("field property `readonly` is not an boolean",this),this.readonly=e,this}}),i=Class.extend({init:function(){this.data={merchant_id:null,currency:null,fields:[],params:{}}},validate:function(){var e,t=[],n=this.data;for(e in n)n.hasOwnProperty(e)&&n[e]===null&&t.push(["data param -",e,"is incorrect"].join(" "));return t},setProtocol:function(t){t&&t.match(/https?/)&&(e=t)},setHost:function(e){e&&(t=e)},getButton:function(e,t,n){var r=document.createElement("a");return r.href=this.getUrl(),r.className=t||"",r.innerHTML=e,r.target=n,r},getUrl:function(){var r;return(r=this.validate()).length>0?console.error(r.join("\n")):e.concat("://").concat(t).concat(n).concat(encodeURIComponent(JSON.stringify(this.data)))},setMerchantId:function(e){isNumber(e)||console.error("parameter `merchant_id` is required and must be integer"),this.data.merchant_id=e},setAmount:function(e,t,n){isNumber(parseInt(e))&&(this.data.amount=e),isString(t)&&(this.data.currency=t),isBoolean(n)&&n===!0&&(this.data.amount_readonly=n)},setResponseUrl:function(e){return isString(e)||console.error("parameter `url` is required and must be string"),this.addParam("response_url",e),this},addField:function(e){return isObject(e)||console.error("parameter field is required"),this.data.fields.push(new r(e)),this},addParam:function(e,t){return this.data.params[e]=t,this},setRecurringReadonly:function(e){this.data.recurring_readonly=Boolean(e)},setRecurringState:function(e){this.data.recurring_state=Boolean(e)},addRecurringData:function(e){this.data.params.subscription="y",this.data.recurring={period:e.period||"month",every:e.every||1,start_time:e.start_time||"",end_time:e.end_time||this.getDefaultEndDate(),amount:this.data.amount||"",custom_period:e.period&&e.every}},calcStartDate:function(e){return e.period&&e.every?this.getFuturePeriod(e.period,e.every):null},getFuturePeriod:function(e,t){var n=new Date;switch(e){case"day":n.setDate(n.getDate()+1*t);break;case"week":n.setDate(n.getDate()+7*t);break;case"month":n.setMonth(n.getMonth()+1*t);break;case"year":n.setFullYear(n.getFullYear()+1*t)}return this.getDateFormat(n)},getDefaultStartDate:function(e,t){var n=new Date;return n.setMonth(n.getMonth()+1),this.getDateFormat(n)},getDefaultEndDate:function(){var e=new Date;return e.setFullYear(e.getFullYear()+5),this.getDateFormat(e)},getDateFormat:function(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}});this.$ipsp.add("button",i)}.call(window||{}),function(){var e={frameborder:"0",allowtransparency:"true",scrolling:"no"},t={zIndex:"9999",overflowX:"hidden",border:"0",display:"none",position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"100%"},n=Module.extend({name:"$ipsp.frame3ds",frame:null,form:null,wrapper:"body",isloaded:!1,options:{url:"",data:{},wrapper:{}},init:function(){this.name=[this.name,Math.round(Math.random()*1e9)].join(""),this.initFrame(),this.initEvents(),this.initConnector()},action:function(e,t){return pubsub.subscribe([this.name,e].join(":"),t)},send:function(e,t){return pubsub.publish([this.name,e].join(":"),t||{}),this},removeAction:function(e){return pubsub.unsubscribe(e),this},setLocale:function(e){this.locale=e},initEvents:function(){this.addEvent(this.iframe,"load",this.proxy(function(){this.loadConnector(),this.send("load",{}),this.addCss(this.iframe,{height:"720px"})}))},initFrame:function(t){this.iframe=this.find(t)||document.createElement("iframe"),this.iframe.name=this.name,this.iframe.id=this.name,this.addAttr(this.iframe,e),this.addCss(this.iframe,{width:"100%",height:"100%"})},initConnector:function(){this.connector=new Connector,this.connector.action("response",this.proxy(function(e,t){this.send(t,e)}))},loadConnector:function(){this.connector.setTarget(this.iframe.contentWindow)},setData:function(e){return this.extend(this.options,e),this},setWrapper:function(e){isString(e)?this.wrapper=this.find(e):this.wrapper=e;if(!e)throw Error("acsframe element wrapper is undefined");return this},submitHelp:function(){this.form=prepareFormData(this.options.url,this.options.send_data,this.name),this.form.target="_blank",this.wrapper.appendChild(this.form),this.form.submit()},submit:function(){this.form=prepareFormData(this.options.url,this.options.send_data,this.name),this.wrapper.appendChild(this.iframe),this.wrapper.appendChild(this.form),this.form.submit()}});this.$ipsp.add("acsframe",n)}.call(window||{}),function(){var e=Module.extend({name:"$ipsp.frame3ds",target:"_blank",frame:null,form:null,wrapper:"body",isloaded:!1,options:{url:"",data:{},wrapper:{}},init:function(){this.name=[this.name,Math.round(Math.random()*1e9)].join(""),this.initEvents()},action:function(e,t){return pubsub.subscribe([this.name,e].join(":"),t)},send:function(e,t){return pubsub.publish([this.name,e].join(":"),t||{}),this},removeAction:function(e){return pubsub.unsubscribe(e),this},initEvents:function(){this.action("close",this.proxy(function(){this.find(this.wrapper).removeChild(this.form)}))},setData:function(e){return this.extend(this.options,e),this},setWrapper:function(e){if(!e)throw Error("asc submit wrapper element is undefined");return isString(e)?this.wrapper=this.find(e):isElement(e)&&(this.wrapper=e),this},submit:function(){return this.form=prepareFormData(this.options.url,this.options.send_data,this.name),this.wrapper.appendChild(this.form),this.popup=window.open("about:blank",this.name),this.popup&&popupBlocker(this.popup)?this.form.submit():this.send("blocked3dsPopup",this.options),this}});this.$ipsp.add("acssubmit",e)}.call(window||{}),function(){var e={};e.modal={display:"block",overflow:"hidden",position:"relative",background:"#fff",zIndex:"99999",boxShadow:"0px 0px 5px rgba(0,0,0,0.2)"},e.title={margin:"0px",overflow:"hidden",padding:"17px 20px",fontFamily:"Arial, Helvetica",lineHeight:"14px",fontSize:"12px"},e.button={display:"block","float":"right",position:"relative",fontWeight:"bold",fontSize:"48px",padding:"0 8px",lineHeight:"100%",cursor:"pointer"},e.wrapper={position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:"9999",display:"none",overflowY:"auto",background:"rgba(0,0,0,0.1)"};var t=Module.extend({init:function(){this.wrapper=this.elem("div",e.wrapper),this.wrapper.className="oplata_popup_wrapper ipsp_popup_wrapper",this.modal=this.elem("div",e.modal),this.modal.className="oplata_popup_modal ipsp_popup_modal",this.toolbar=this.elem("div"),this.toolbar.className="oplata_popup_toolbar ipsp_popup_toolbar",this.title=this.elem("div"),this.title.className="oplata_popup_title ipsp_popup_title",this.addCss(this.title,e.title),this.closelink=this.elem("a"),this.closelink.className="oplata_popup_close ipsp_popup_close",this.closelink.innerHTML="&times",this.addEvent(this.closelink,"click",this.proxy(function(e){e.preventDefault(),this.hide(),this.close()})),this.addCss(this.closelink,e.button),this.toolbar.appendChild(this.closelink),this.toolbar.appendChild(this.title),this.addCss(this.toolbar,{position:"relative",zIndex:"5",overflow:"hidden"}),this.content=this.elem("div"),this.content.className="oplata_popup_content",this.addCss(this.content,{position:"relative",zIndex:"2"}),this.modal.appendChild(this.toolbar),this.modal.appendChild(this.content),this.wrapper.appendChild(this.modal),this.find("body").appendChild(this.wrapper)},elem:function(e,t){var n=document.createElement(e);return t&&this.addCss(n,t),n},config:function(e){this.addCss(this.modal,{top:"100px",left:"50%",marginLeft:-(parseInt(e.width,10)/2)+"px",width:e.width||"auto",height:e.height||"auto"})},show:function(){this.addCss(this.wrapper,{display:"block"}),this.addCss(this.find("body"),{overflow:"hidden"}),this.addCss(this.find("html"),{overflow:"hidden"})},hide:function(){this.addCss(this.wrapper,{display:"none"}),this.addCss(this.find("body"),{overflow:""}),this.addCss(this.find("html"),{overflow:""}),this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)},close:function(){}});this.$ipsp.add("popup",t)}.call(window||{});
